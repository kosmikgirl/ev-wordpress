'use strict';

!function(a){function l(t,e){this.$el=a(t),this.id=Math.random(),this.options=e,this.multiple=this.$el.prop("multiple"),this.activeOpt=null,this.widthSet=!1,this.generate()}function i(t,e){this.$el=a(t),this.wSelect=e}l.prototype={generate:function(){var e,t;return this.$select||((e=this).$select=a('<div class="wSelect"><div class="wSelect-arrow"></div></div>'),this.$optionsHolder=a('<div class="wSelect-options-holder"></div>'),this.$options=a('<div class="wSelect-options"></div>'),a.support.placeholder||this.$select.css("zIndex",100-this.$el.index()),t=function(t){t.stopPropagation(),a("select").each(function(){var t=a(this).data("wSelect");t&&t.id!==e.id&&(t.multiple||t.$optionsHolder.hide(),t.onBlur())}),e.multiple||e.onClick(t),e.$el.focus()},this.multiple?(this.$select.addClass("wSelect-multiple"),this.$optionsHolder.click(t)):(this.$selected=a('<div class="wSelect-selected"></div>'),this.$select.append(this.$selected),this.$select.click(t),this.$optionsHolder.click(function(t){t.stopPropagation(),e.$el.focus()})),this.$select.hover(function(){e.onFocus("hover")},function(){e.onBlur("hover")}),this.$el.addClass("wSelect-el").change(function(){e.change()}).focus(function(){e.onFocus()}).keydown(function(t){e.keydown(t)}).keyup(function(t){e.keyup(t)}),a(document).click(function(){e.multiple||e.$optionsHolder.hide(),e.onBlur()}),this.widthSet=0<this.$select.width(),this.setTheme(this.options.theme),this.setSize(this.options.size),this.reset(),this.$optionsHolder.append(this.$options),this.$select.append(this.$optionsHolder),this.$el.after(this.$select)),this.$select},reset:function(){var e=this;this.$options.children().remove(),this.$el.children().each(function(){var t=new i(this,e);a.data(this,"wSelect-option",t),e.$options.append(t.generate())}),this.$options.children().removeClass("wSelect-option-last").last().addClass("wSelect-option-last"),this.setSize(this.options.size)},change:function(){this.$options.children().removeClass("wSelect-option-selected wSelect-option-active"),this.$el.children(":selected").each(function(){a(this).data("wSelect-option").select()})},keydown:function(t){9===t.keyCode&&(this.$optionsHolder.hide(),this.onBlur())},keyup:function(t){var e,i,s,o,l;13===t.keyCode?this.$optionsHolder.hide():37<=t.keyCode&&t.keyCode<=40&&(this.change(),e=this.$options.find(".wSelect-option-selected:last"),i=this.$options.scrollTop(),s=e.position().top+i,o=this.$options.height(),l=e.outerHeight(!0),s-i<0?this.$options.scrollTop(s):o<s+l-i&&this.$options.scrollTop(s-o+l))},onClick:function(t){var e,i,s,o,l;this.$optionsHolder.is(":visible")||(s=(e=this.$select.offset().top-a(window).scrollTop())-(i=this.$optionsHolder.outerHeight()),l=0<(o=a(window).height()-(e+this.$select.outerHeight()+i+5))||s<o?this.$select.height():-i,this.$optionsHolder.css("top",l)),this.$optionsHolder.toggle()},onFocus:function(t){t=t||"active",this.options.highlight&&this.$select.addClass("wSelect-"+t)},onBlur:function(t){t=t||"active",this.options.highlight&&this.$select.removeClass("wSelect-"+t)},setTheme:function(t){this.$select.attr("class",this.$select.attr("class").replace(/wSelect-theme-.+\s|wSelect-theme-.+$/,"")),this.$select.addClass("wSelect-theme-"+t)},setSize:function(t){var e,i=this.$options.children(":first").clone().css({position:"absolute",left:-1e4}),s=this.$el.children().length;a("body").append(i),e=2*i.outerHeight(!0),i.remove(),!this.multiple&&s<t&&(t=s),this.$options.height(e*t-1)}},i.prototype={generate:function(){var t,e=this;return this.$option||(t=this.$el.attr("data-icon"),this.$option=a('<div class="wSelect-option"></div>'),this.$value=a('<div class="wSelect-option-value"></div>'),this.$option.append(this.$value),"string"==typeof t&&(this.$value.addClass("wSelect-option-icon"),this.$value.css("backgroundImage","url("+t+")"))),this.$el.prop("selected")&&this.select(),this.$el.prop("disabled")?this.$option.addClass("wSelect-option-disabled"):(this.$option.removeClass("wSelect-option-disabled"),this.$option.unbind("click").click(function(t){e.onClick(t)})),this.$value.html(this.$el.html()),this.setWidth(),this.$option},select:function(){var t;this.wSelect.activeOpt||(this.wSelect.activeOpt=this),this.wSelect.multiple||("string"==typeof(t=this.$el.attr("data-icon"))?(this.wSelect.$selected.addClass("wSelect-option-icon"),this.wSelect.$selected.css("backgroundImage","url("+t+")")):(this.wSelect.$selected.removeClass("wSelect-option-icon"),this.wSelect.$selected.css("backgroundImage","")),this.wSelect.$selected.html(this.$el.html())),this.$option.addClass("wSelect-option-selected")},onClick:function(t){var e=null;if(this.wSelect.multiple&&(t.ctrlKey||t.shiftKey)){if(t.ctrlKey||!this.wSelect.activeOpt){e=this.wSelect.$el.val()||[];var i=this.$el.val(),s=a.inArray(i,e);-1===s?(e.push(this.$el.val()),this.wSelect.activeOpt=this):e.splice(s,1)}else if(t.shiftKey)for(var o=this.wSelect.activeOpt.$el.index(),l=this.$el.index(),n=0,h=0,c=null,h=o<l?(n=o,l):(n=l,o),e=[],p=n;p<=h;p++)(c=this.wSelect.$el.children(":eq("+p+")")).is(":not(:disabled)")&&e.push(c.val())}else e=this.$el.val(),this.wSelect.$optionsHolder.hide(),this.wSelect.activeOpt=this;this.wSelect.$el.val(e).change()},setWidth:function(){if(this.wSelect.multiple||this.wSelect.widthSet)return!0;this.$option.hide().appendTo("body");var t=this.$option.width();t>this.wSelect.$select.width()&&this.wSelect.$select.width(t),this.$option.detach().show()}},a.support.placeholder="placeholder"in document.createElement("input"),a.fn.wSelect=function(s,i){if("string"==typeof s){var o=[],t=this.each(function(){var t,e=a(this).data("wSelect");e&&(t=(i?"set":"get")+s.charAt(0).toUpperCase()+s.substring(1).toLowerCase(),e[s]?e[s].apply(e,[i]):i?(e[t]&&e[t].apply(e,[i]),e.options[s]&&(e.options[s]=i)):e[t]?o.push(e[t].apply(e,[i])):e.options[s]?o.push(e.options[s]):o.push(null))});return 1===o.length?o[0]:0<o.length?o:t}return s=a.extend({},a.fn.wSelect.defaults,s),this.each(function(){var t,e,i;t=this,(i=a.data(t,"wSelect"))||((e=jQuery.extend(!0,{},s)).size=a(t).prop("size")||e.size,i=new l(t,e),a.data(t,"wSelect",i))})},a.fn.wSelect.defaults={theme:"classic",size:4,highlight:!0}}(jQuery);