import*as lpUtils from"lpAssetsJsPath/utils.js";import*as lpToastify from"lpAssetsJsPath/lpToastify.js";import SweetAlert from"sweetalert2";import{EditSection}from"./edit-section.js";import{EditSectionItem}from"./edit-section-item.js";import{EditCourseCurriculum}from"lpAssetsJsPath/admin/edit-course/edit-curriculum.js";let editSection=null,editSectionItem=null;export class EditCurriculumAi{constructor(){this.init()}static selectors={elBtnApplyCurriculum:".lp-btn-apply-curriculum"};init(){lpData?.enable_open_ai&&(lpUtils.lpOnElementReady(EditCourseCurriculum.selectors.idElEditCurriculum,e=>{e.querySelector(EditSection.selectors.elCountSections).insertAdjacentHTML("afterend",'<button type="button"\n\t\t\t\t\tclass="lp-btn-generate-with-ai lp-btn-ai-style"\n\t\t\t\t\tdata-template="#lp-tmpl-edit-course-curriculum-ai">\n\t\t\t\t\t<i class="lp-ico-ai"></i><span>Generate with AI</span>\n\t\t\t\t</button>')}),this.events())}events(){EditCurriculumAi._loadedEvents||(EditCurriculumAi._loadedEvents=!0,lpUtils.eventHandlers("click",[{selector:EditCurriculumAi.selectors.elBtnApplyCurriculum,class:this,callBack:this.applyData.name}]))}async applyData(e){const{e:t,target:i}=e;let o=JSON.parse(i.dataset.send);if(o=lpUtils.mergeDataWithDatForm(i.closest("form"),o),!o["lp-openai-generated-data"])return;const s=JSON.parse(o["lp-openai-generated-data"])[0].sections;s&&0!==s.length||lpToastify.show("No sections found in the generated data.","error"),console.log("Generated Sections:",s),SweetAlert.close(),await new Promise(e=>setTimeout(e,500)),editSection=new EditSection,editSection.init(),editSectionItem=new EditSectionItem,editSectionItem.init();const c=document.querySelector(EditCourseCurriculum.selectors.idElEditCurriculum);c.querySelector(EditSection.selectors.elDivAddNewSection).scrollIntoView({behavior:"smooth",block:"center"}),await new Promise(e=>setTimeout(e,800));for(const e of s){const t=c.querySelector(EditSection.selectors.elSectionTitleNewInput),i=c.querySelector(EditSection.selectors.elBtnAddSection);t.value=e.section_title||"",await new Promise(t=>{editSection.addSection({e:new PointerEvent("click"),target:i,callBackNest:this.updateSectionDescription({sectionData:e,elEditCurriculum:c}),resolve:t})})}}updateSectionDescription(e){const{sectionData:t,elEditCurriculum:i}=e;return{success:async e=>{const{elSection:o}=e;await new Promise(e=>setTimeout(e,1e3));const s=o.querySelector(EditSection.selectors.elSectionDesInput);s.value=t.section_description||"",await new Promise(e=>{editSection.updateSectionDescription({e:new PointerEvent("click"),target:s,callBackNest:this.addSectionItems({sectionData:t,elEditCurriculum:i}),resolve:e})}),setTimeout(e.resolve,1)},error:e=>{},completed:()=>{}}}addSectionItems(e){const{sectionData:t,elEditCurriculum:i}=e,o=t.lessons||[],s=t.quizzes||[];return{success:async e=>{const{elSection:t}=e,c=t.querySelector(`${EditSectionItem.selectors.elBtnSelectItemType}[data-item-type=lp_lesson]`),l=t.querySelector(`${EditSectionItem.selectors.elBtnSelectItemType}[data-item-type=lp_quiz]`);for(const e of o)c.click(),await this.addItemToSection({itemData:e,elSection:t,elEditCurriculum:i});for(const e of s)l.click(),await this.addItemToSection({itemData:e,elSection:t,elEditCurriculum:i});setTimeout(e.resolve,1)},error:e=>{},completed:()=>{}}}async addItemToSection(e){const{itemData:t,elSection:i,elEditCurriculum:o}=e,s=i.querySelector(EditSectionItem.selectors.elBtnAddItem);i.querySelector(EditSectionItem.selectors.elAddItemTypeTitleInput).value=t.lesson_title||t.quiz_title||"",s.scrollIntoView({behavior:"smooth",block:"center"}),await new Promise(e=>{editSectionItem.addItemToSection({e:new PointerEvent("click"),target:s,resolve:e,callBackNest:{completed:async t=>{setTimeout(e,1e3)}}})}),setTimeout(e.resolve,1)}}